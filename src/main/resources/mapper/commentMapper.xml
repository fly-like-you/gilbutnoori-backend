<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.gilbut.domain.comment.mapper.CommentMapper">
    <resultMap id="CommentResultMap" type="Comment">
        <id property="id" column="comment_id"/>
        <result property="content" column="comment_content"/>
        <result property="createdAt" column="comment_created_at"/>
        <result property="updatedAt" column="comment_updated_at"/>
        <association property="user" javaType="User">
            <id property="id" column="user_id"/>
            <result property="nickname" column="user_nickname"/>
            <result property="profileImg" column="user_profile_img"/>
        </association>
    </resultMap>

    <select id="listComment" resultMap="CommentResultMap">
        SELECT c.id          AS comment_id,
               c.content     AS comment_content,
               c.created_at  AS comment_created_at,
               c.updated_at  AS comment_updated_at,
               u.id          AS user_id,
               u.nickname    AS user_nickname,
               u.profile_img AS user_profile_img
        FROM Comments c
                 INNER JOIN Users u
                            ON c.user_id = u.id
        ORDER BY c.created_at
    </select>

    <select id="findCommentByCommentId" resultMap="CommentResultMap">
        SELECT c.id          AS comment_id,
               c.content     AS comment_content,
               c.created_at  AS comment_created_at,
               c.updated_at  AS comment_updated_at,
               u.id          AS user_id,
               u.nickname    AS user_nickname,
               u.profile_img AS user_profile_img
        FROM Comments c
                 INNER JOIN Users u
                            ON c.user_id = u.id
        WHERE c.id = #{commentId}
    </select>

    <insert id="createComment" parameterType="com.ssafy.gilbut.domain.comment.model.dto.CommentRequest$CreateDTO"
    useGeneratedKeys="true" keyProperty="dto.id">
        INSERT INTO Comments
            (board_id, user_id, content)
        VALUE (
            #{dto.boardId}, #{userId}, #{dto.content}
            )
    </insert>

    <update id="updateComment" parameterType="com.ssafy.gilbut.domain.comment.model.dto.CommentRequest$UpdateDTO">
        UPDATE Comments
        SET
            content = #{dto.content}
        WHERE
            id = #{commentId}
    </update>

    <delete id="deleteComment">
        DELETE FROM Comments
        WHERE id = #{commentId}
    </delete>


</mapper>